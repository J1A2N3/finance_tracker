--user table

CREATE TABLE user (user_id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(100) NOT NULL,email VARCHAR(100) UNIQUE NOT NULL,password VARCHAR(100) NOT NULL);

-- transaction table

CREATE TABLE transactions (txn_id INT AUTO_INCREMENT PRIMARY KEY,user_id INT NOT NULL,type ENUM('INCOME','EXPENSE') NOT NULL,amount DECIMAL(10,2) NOT NULL,
txn_date DATETIME DEFAULT CURRENT_TIMESTAMP,FOREIGN KEY (user_id) REFERENCES Users(user_id));

-- procedure to checksavingsgoal

DELIMITER $$
CREATE PROCEDURE CheckSavingsGoal(IN p_user_id INT,IN p_goal DECIMAL(10,2),OUT p_result VARCHAR(255))
BEGIN
    DECLARE v_balance DECIMAL(10,2);
    SELECT IFNULL(SUM(CASE WHEN type='INCOME' THEN amount ELSE -amount END), 0)
    INTO v_balance
    FROM Transactions
    WHERE user_id = p_user_id;
    IF v_balance >= p_goal THEN
        SET p_result = 'Congratulations! You reached your goal ';
    ELSE
        SET p_result = CONCAT('Keep saving! You still need ', p_goal - v_balance);
    END IF;
END $$
DELIMITER ;
